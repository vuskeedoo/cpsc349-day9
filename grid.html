<!DOCTYPE html>
<html lang="en">

<head>
  <title>Player characters on a grid</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/modern-normalize/0.5.0/modern-normalize.css">
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css">
</head>

<body>
  <header>
    <h1>Use the controls to move the characters.</h1>
  </header>

  <main>
    <table id="grid">
      <tr>
        <td data-x="0" data-y="0">(0, 0)</td>
        <td data-x="1" data-y="0">(1, 0)</td>
        <td data-x="2" data-y="0">(2, 0)</td>
        <td data-x="3" data-y="0">(3, 0)</td>
        <td data-x="4" data-y="0">(4, 0)</td>
        <td data-x="5" data-y="0">(5, 0)</td>
        <td data-x="6" data-y="0">(6, 0)</td>
        <td data-x="7" data-y="0">(7, 0)</td>
      </tr>
      <tr>
        <td data-x="0" data-y="1">(0, 1)</td>
        <td data-x="1" data-y="1">(1, 1)</td>
        <td data-x="2" data-y="1">(2, 1)</td>
        <td data-x="3" data-y="1">(3, 1)</td>
        <td data-x="4" data-y="1">(4, 1)</td>
        <td data-x="5" data-y="1">(5, 1)</td>
        <td data-x="6" data-y="1">(6, 1)</td>
        <td data-x="7" data-y="1">(7, 1)</td>
      </tr>
      <tr>
        <td data-x="0" data-y="2">(0, 2)</td>
        <td data-x="1" data-y="2">(1, 2)</td>
        <td data-x="2" data-y="2">(2, 2)</td>
        <td data-x="3" data-y="2">(3, 2)</td>
        <td data-x="4" data-y="2">(4, 2)</td>
        <td data-x="5" data-y="2">(5, 2)</td>
        <td data-x="6" data-y="2">(6, 2)</td>
        <td data-x="7" data-y="2">(7, 2)</td>
      </tr>
      <tr>
        <td data-x="0" data-y="3">(0, 3)</td>
        <td data-x="1" data-y="3">(1, 3)</td>
        <td data-x="2" data-y="3">(2, 3)</td>
        <td data-x="3" data-y="3">(3, 3)</td>
        <td data-x="4" data-y="3">(4, 3)</td>
        <td data-x="5" data-y="3">(5, 3)</td>
        <td data-x="6" data-y="3">(6, 3)</td>
        <td data-x="7" data-y="3">(7, 3)</td>
      </tr>
      <tr>
        <td data-x="0" data-y="4">(0, 4)</td>
        <td data-x="1" data-y="4">(1, 4)</td>
        <td data-x="2" data-y="4">(2, 4)</td>
        <td data-x="3" data-y="4">(3, 4)</td>
        <td data-x="4" data-y="4">(4, 4)</td>
        <td data-x="5" data-y="4">(5, 4)</td>
        <td data-x="6" data-y="4">(6, 4)</td>
        <td data-x="7" data-y="4">(7, 4)</td>
      </tr>
      <tr>
        <td data-x="0" data-y="5">(0, 5)</td>
        <td data-x="1" data-y="5">(1, 5)</td>
        <td data-x="2" data-y="5">(2, 5)</td>
        <td data-x="3" data-y="5">(3, 5)</td>
        <td data-x="4" data-y="5">(4, 5)</td>
        <td data-x="5" data-y="5">(5, 5)</td>
        <td data-x="6" data-y="5">(6, 5)</td>
        <td data-x="7" data-y="5">(7, 5)</td>
      </tr>
      <tr>
        <td data-x="0" data-y="6">(0, 6)</td>
        <td data-x="1" data-y="6">(1, 6)</td>
        <td data-x="2" data-y="6">(2, 6)</td>
        <td data-x="3" data-y="6">(3, 6)</td>
        <td data-x="4" data-y="6">(4, 6)</td>
        <td data-x="5" data-y="6">(5, 6)</td>
        <td data-x="6" data-y="6">(6, 6)</td>
        <td data-x="7" data-y="6">(7, 6)</td>
      </tr>
      <tr>
        <td data-x="0" data-y="7">(0, 7)</td>
        <td data-x="1" data-y="7">(1, 7)</td>
        <td data-x="2" data-y="7">(2, 7)</td>
        <td data-x="3" data-y="7">(3, 7)</td>
        <td data-x="4" data-y="7">(4, 7)</td>
        <td data-x="5" data-y="7">(5, 7)</td>
        <td data-x="6" data-y="7">(6, 7)</td>
        <td data-x="7" data-y="7">(7, 7)</td>
      </tr>
    </table>
  </main>

  <h2>Player 1</h2>
  <nav id="player1">
    <button data-direction="up">w</button>
    <button data-direction="left">a</button>
    <button data-direction="down">s</button>
    <button data-direction="right">d</button>
  </nav>

  <h2>Player 2</h2>
  <nav id="player2">
    <button data-direction="up">i</button>
    <button data-direction="left">j</button>
    <button data-direction="down">k</button>
    <button data-direction="right">l</button>
  </nav>

  <footer>
    <h3>Credits</h3>
    <ul>
      <li>Graphics courtesy of <a href="https://www.gameart2d.com/freebies.html">Game Art 2D</a>.</li>
      <li>Sprite sheet CSS courtesy of <a href="http://www.spritecow.com/">Sprite Cow</a>.</li>
    </ul>
    <script type="text/javascript">

      let p1 = { x: 0, y: 0 }
      let p2 = { x: 7, y: 7 }

      window.onload = function () {
        startGame();
      };

      function startGame() {

        let p1keys = document.getElementById('player1').getElementsByTagName('button');
        let p2keys = document.getElementById('player2').getElementsByTagName('button');

        //console.log(p1keys.getElementsByTagName('button')[0]);

        for (let i = 0; i < p1keys.length; i++) {
          console.log (p1keys[i].getAttribute('data-direction'));
          console.log (p1keys[i]);
          p1keys[i].addEventListener("click", function () {
           move('player1', p1keys[i].getAttribute('data-direction')) });
        }

        for (let i = 0; i < p2keys.length; i++) {
          console.log (p2keys[i].getAttribute('data-direction'));
          console.log (p2keys[i]);
          p2keys[i].addEventListener("click", function () {
           move('player2', p2keys[i].getAttribute('data-direction')) });
        }

        let board = document.getElementsByTagName("td");
        for (let i = 0; i < board.length; i++) {
          board[i].innerHTML = ('<img id="tile" src="img/tile.png" alt="tile"/>');
          if (board[i].getAttribute('data-x') == '0' && board[i].getAttribute('data-y') == '0') {
            board[i].innerHTML = ('<img id="sprite-dino" src="img/dino.png" alt="dino"/>');
          }
          if (board[i].getAttribute('data-x') == '7' && board[i].getAttribute('data-y') == '7') {
            board[i].innerHTML = ('<img id="sprite-santa" src="img/santa.png" alt="santa"/>');
          }
        }
        document.addEventListener('keypress', function (e) {
          if (e.key == 'w') {
            move("player1", "up");
            console.log("player1 move up");
          } else if (e.key == 'a') {
            move("player1", "left");
            console.log("player1 move left");
          } else if (e.key == 's') {
            move("player1", "down");
            console.log("player1 move down");
          } else if (e.key == 'd') {
            move("player1", "right");
            console.log("player1 move right");
          } else if (e.key == 'i') {
            move("player2", "up");
            console.log("player2 move up");
          } else if (e.key == 'j') {
            move("player2", "left");
            console.log("player2 move left");
          } else if (e.key == 'k') {
            move("player2", "down");
            console.log("player2 move down");
          } else if (e.key == 'l') {
            move("player2", "right");
            console.log("player2 move right");
          }
        });
      }

      function move(player, direction) {
        let cells = grid.getElementsByTagName("td");

        let oldx = 0;
        let oldy = 0;

        if (player == 'player1') {
          oldx = p1.x;
          oldy = p1.y;
        }
        if (player == 'player2') {
          oldx = p2.x;
          oldy = p2.y;
        }

        let newx = oldx;
        let newy = oldy;


        if (direction == 'down') {
          newy += 1;
        }
        if (direction == 'up') {
          newy -= 1;
        }
        if (direction == 'left') {
          newx -= 1;
        }
        if (direction == 'right') {
          newx += 1;
        }

        if (legalMove(newx, newy)) {
          replace(tile, oldx, oldy);
          replace(player, newx, newy);
          if (player == 'player1') {
            p1.x = newx;
            p1.y = newy;
          }
          if (player == 'player2') {
            p2.x = newx;
            p2.y = newy;
          }
        }
      }

      function legalMove(newx, newy) {
        return !((p1.x == newx && p1.y == newy) || (p2.x == newx && p2.y == newy)
          || newx < 0 || newx > 7 || newy < 0 || newy > 7)
      }

      function replace(type, x, y) {
        let toReplace = ('<img id="tile" src="img/tile.png" alt="tile"/>');
        if (type == 'player1') {
          toReplace = ('<img id="sprite-dino" src="img/dino.png" alt="dino"/>');
        }
        if (type == 'player2') {
          toReplace = ('<img id="sprite-santa" src="img/santa.png" alt="santa"/>');
        }

        let board = document.getElementsByTagName("td");
        for (let i = 0; i < board.length; i++) {
          if (board[i].getAttribute('data-x') == x.toString(10) && board[i].getAttribute('data-y') == y.toString(10)) {
            console.log('yes');
            board[i].innerHTML = toReplace;
          }
        }

      }

    </script>
  </footer>
</body>

</html>